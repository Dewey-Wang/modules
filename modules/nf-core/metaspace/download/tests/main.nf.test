// nf-core modules test metaspace/download
nextflow_process {

    name "Test Process METASPACE_DOWNLOAD"
    script "../main.nf"
    process "METASPACE_DOWNLOAD"

    tag "modules"
    tag "modules_nfcore"
    tag "metaspace"
    tag "metaspace/download"

    test("METASPACE_DOWNLOAD - datasets") {
        when {
            process {
                """
                input[0] = Channel.from([
                    ['2022-08-05_17h28m56s', 'KEGG', null],
                    ['2022-08-05_17h28m56s', null, null]
                ])
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert process.out.results.size() == 2 },
                { assert process.out.log.size() == 2 },
                { assert process.out.versions.size() == 2 },
            )
        }
    }

    test("METASPACE_DOWNLOAD - wrong_format") {
        when {
            process {
                """
                input[0] = Channel.from([
                    ['2022-08-05_17h28m56s', 'KEGG', null],
                    ['2022-08-05_17h28m56s', null, null],
                    [null, 'KEGG', null] // Missing dataset_id
                ])
                """
            }
        }
        then {
            assertAll(
                { assert process.failed } // Process may succeed unless metaspace_download.py fails on null
            )
        }
    }
}